meteor_tests:
  image: debian:latest
  stage: test
  script:
  - apt-get update
  - apt-get -y install curl locales libfontconfig python
  - locale-gen en_US.UTF-8
  - localedef -i en_GB -f UTF-8 en_US.UTF-8
  - curl https://install.meteor.com/ | sh
  - meteor npm install
  - meteor npm run-script test


build_docker_image:
  image: gitlab/dind:latest
  stage: build
  script:
  - docker info
  - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN registry.gitlab.com
  - docker build -t registry.gitlab.com/aedm/gitlab-test .
  - docker run registry.gitlab.com/aedm/gitlab-test
  - docker push registry.gitlab.com/aedm/gitlab-test
  only:
  - docker

